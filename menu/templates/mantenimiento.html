<!DOCTYPE html>
<html lang="es">
{% load static %}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mantenimiento Personalizado</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="{% static 'css/mantenimiento.css' %}" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="text-center mb-5">
            <h1 class="fw-bold">Mantenimiento Personalizado</h1>
            <p class="text-muted">Selecciona los servicios que deseas para tu bicicleta</p>
        </div>
        <div class="row">
            <div class="col-md-4">
                <div class="card bike-info-card">
                    <div class="card-body">
                        <h3 class="section-title">Datos del Propietario</h3>
                        <div class="form-row">
                            <div class="mb-3">
                                <label class="form-label">Nombre <span class="required">*</span></label>
                                <input type="text" class="form-control" name="first_name" placeholder="Ingresa tu nombre" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Apellido <span class="required">*</span></label>
                                <input type="text" class="form-control" name="last_name" placeholder="Ingresa tu apellido" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">RUT <span class="required">*</span></label>
                            <input type="text" class="form-control" name="rut" placeholder="12.345.678-9" required>
                        </div>
                        <div class="form-row">
                            <div class="mb-3">
                                <label class="form-label">Email <span class="required">*</span></label>
                                <input type="email" class="form-control" name="email" placeholder="tu@email.com" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Teléfono <span class="required">*</span></label>
                                <input type="tel" class="form-control" name="phone" placeholder="9 1234 5678" required>
                            </div>
                        </div>
                        <h3 class="section-title">Datos de la Bicicleta</h3>
                        <div class="form-row">
                            <div class="mb-3">
                                <label class="form-label">Marca <span class="required">*</span></label>
                                <select class="form-select" name="bike_brand" required>
                                    <option value="">Seleccione una marca</option>
                                    <option value="trek">Trek</option>
                                    <option value="giant">Giant</option>
                                    <option value="specialized">Specialized</option>
                                    <option value="cannondale">Cannondale</option>
                                    <option value="scott">Scott</option>
                                    <option value="bianchi">Bianchi</option>
                                    <option value="orbea">Orbea</option>
                                    <option value="merida">Merida</option>
                                    <option value="other">Otra</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Año</label>
                                <input type="number" class="form-control" name="bike_year" placeholder="2024" min="1980" max="2025">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="mb-3">
                                <label class="form-label">Color <span class="required">*</span></label>
                                <select class="form-select" name="bike_color" required>
                                    <option value="">Seleccione un color</option>
                                    <option value="negro">Negro</option>
                                    <option value="blanco">Blanco</option>
                                    <option value="rojo">Rojo</option>
                                    <option value="azul">Azul</option>
                                    <option value="verde">Verde</option>
                                    <option value="amarillo">Amarillo</option>
                                    <option value="naranja">Naranja</option>
                                    <option value="gris">Gris</option>
                                    <option value="multicolor">Multicolor</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Tipo <span class="required">*</span></label>
                                <select class="form-select" name="bike_type" required>
                                    <option value="">Seleccione el tipo</option>
                                    <option value="mountain">Montaña</option>
                                    <option value="road">Ruta</option>
                                    <option value="hybrid">Híbrida</option>
                                    <option value="bmx">BMX</option>
                                    <option value="electric">Eléctrica</option>
                                    <option value="folding">Plegable</option>
                                    <option value="cruiser">Cruiser</option>
                                    <option value="city">Urbana</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notas Adicionales</label>
                            <textarea class="form-control" name="additional_notes" rows="3" placeholder="Información adicional sobre la bicicleta..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="card services-card">
                    <div class="card-body">
                        <h3 class="section-title">Servicios Disponibles</h3>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="service-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">Cambio pastillas freno</h6>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <span class="price me-3">$10.000</span>
                                            <input type="checkbox" class="form-check-input service" data-price="10000">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="service-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">Lubricación de cadena</h6>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <span class="price me-3">$5.000</span>
                                            <input type="checkbox" class="form-check-input service" data-price="5000">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="service-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">Centrado ruedas</h6>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <span class="price me-3">$12.000</span>
                                            <input type="checkbox" class="form-check-input service" data-price="12000">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="service-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">Cambio de ruedas y fundas</h6>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <span class="price me-3">$15.000</span>
                                            <input type="checkbox" class="form-check-input service" data-price="15000">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="service-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">Limpieza profunda</h6>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <span class="price me-3">$8.000</span>
                                            <input type="checkbox" class="form-check-input service" data-price="8000">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="total-section">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="mb-2">
                                        <strong>IVA:</strong> <span id="iva">$0</span>
                                    </div>
                                    <div class="mb-2">
                                        <strong>Subtotal:</strong> <span id="subtotal">$0</span>
                                    </div>
                                    <div class="mb-3">
                                        <strong>Total:</strong> <span id="total">$0</span>
                                    </div>
                                    <button type="button" class="btn-finish" onclick="finalizarPedido()">
                                        Finalizar Pedido
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const checkboxes = document.querySelectorAll(".service");
        const subtotalEl = document.getElementById("subtotal");
        const ivaEl = document.getElementById("iva");
        const totalEl = document.getElementById("total");
        let subtotal = 0;
    const ivaRate = 0.19;

        // Formatear RUT mientras se escribe
        document.querySelector('input[name="rut"]').addEventListener('input', function() {
            let rut = this.value.replace(/[^0-9kK]/g, '');
            if (rut.length > 1) {
                rut = rut.slice(0, -1).replace(/\B(?=(\d{3})+(?!\d))/g, '.') + '-' + rut.slice(-1);
            }
            this.value = rut.toUpperCase();
        });

        function updateTotals() {
            const iva = subtotal * ivaRate;
            const total = subtotal + iva;
            subtotalEl.textContent = `$${subtotal.toLocaleString("es-CL")}`;
            ivaEl.textContent = `$${Math.round(iva).toLocaleString("es-CL")}`;
            totalEl.textContent = `$${Math.round(total).toLocaleString("es-CL")}`;
        }

        checkboxes.forEach(cb => {
            cb.addEventListener("change", () => {
                const price = parseInt(cb.getAttribute("data-price"));
                if (cb.checked) {
                    subtotal += price;
                } else {
                    subtotal -= price;
                }
                updateTotals();
            });
        });

        function finalizarPedido() {
            // Validar datos del propietario
            const nombre = document.querySelector('input[name="first_name"]').value;
            const apellido = document.querySelector('input[name="last_name"]').value;
            const rut = document.querySelector('input[name="rut"]').value;
            const email = document.querySelector('input[name="email"]').value;
            const telefono = document.querySelector('input[name="phone"]').value;
            
            // Validar datos de la bicicleta
            const marca = document.querySelector('select[name="bike_brand"]').value;
            const color = document.querySelector('select[name="bike_color"]').value;
            const tipo = document.querySelector('select[name="bike_type"]').value;
            
            // Verificar campos obligatorios
            if (!nombre || !apellido || !rut || !email || !telefono) {
                alert("Por favor, complete todos los datos personales obligatorios");
                return;
            }
            if (!marca || !color || !tipo) {
                alert("Por favor, complete los datos básicos de la bicicleta (marca, color y tipo)");
                return;
            }
            if (subtotal === 0) {
                alert("Por favor, selecciona al menos un servicio");
                return;
            }
            alert(`Pedido registrado para ${nombre} ${apellido}\nBicicleta: ${marca} ${color}\nTotal: ${totalEl.textContent}`);
        }
    </script>
</body>
</html>